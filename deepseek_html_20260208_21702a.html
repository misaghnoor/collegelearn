<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم آزمون قاضی کلاس - پایه پنجم</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003/Vazirmatn-font-face.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Vazirmatn, sans-serif;
        }
        
        :root {
            --primary-color: #1a5fb4;
            --secondary-color: #26a269;
            --accent-color: #e5a50a;
            --danger-color: #c01c28;
            --warning-color: #f5c211;
            --light-color: #f6f5f4;
            --dark-color: #241f31;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        body {
            background-color: #f8f9fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), #3584e4);
            color: white;
            padding: 25px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .admin-access {
            position: absolute;
            left: 20px;
            top: 20px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            color: var(--primary-color);
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--accent-color);
        }
        
        /* صفحه ثبت نام */
        #register-screen {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 25px;
            text-align: right;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.2);
        }
        
        /* صفحه شروع */
        #start-screen {
            text-align: center;
        }
        
        .student-info-card {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border-right: 5px solid var(--primary-color);
        }
        
        .student-info-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .student-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            text-align: right;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .detail-label {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .start-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-box {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            border-right: 5px solid var(--primary-color);
        }
        
        .info-box h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: bold;
            margin: 10px;
        }
        
        .btn:hover {
            background-color: #0d4d9c;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
        }
        
        .btn-success:hover {
            background-color: #1d8c5c;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #d18d0a;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #e0b10e;
        }
        
        /* صفحه آزمون */
        #quiz-screen {
            display: none;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .progress-container {
            flex-grow: 1;
            background-color: var(--light-color);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--secondary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .question-counter {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 18px;
            border-radius: 50px;
            font-weight: bold;
        }
        
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.8;
            color: var(--dark-color);
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .option {
            background-color: var(--light-color);
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 18px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            background-color: #e9f2ff;
            border-color: var(--primary-color);
        }
        
        .option.selected {
            background-color: #e1f0ff;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.2);
        }
        
        .option-label {
            background-color: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .option.selected .option-label {
            background-color: var(--secondary-color);
        }
        
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        /* صفحه نتایج */
        #result-screen {
            display: none;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--secondary-color) 0% 0%, #eee 0% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            position: relative;
        }
        
        .score-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .score-value {
            font-size: 2.5rem;
            color: var(--primary-color);
            line-height: 1;
        }
        
        .score-total {
            font-size: 1.2rem;
            color: var(--dark-color);
            opacity: 0.7;
        }
        
        .result-message {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .result-details {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        
        .result-details h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .answers-review {
            margin-top: 30px;
        }
        
        .review-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .review-item.correct {
            border-right: 5px solid var(--secondary-color);
        }
        
        .review-item.incorrect {
            border-right: 5px solid var(--danger-color);
        }
        
        .review-question {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .review-answer {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .user-answer {
            background-color: #ffeaea;
            color: var(--danger-color);
        }
        
        .correct-answer {
            background-color: #eaffea;
            color: var(--secondary-color);
        }
        
        .result-actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* صفحه مدیریت */
        #admin-screen {
            display: none;
        }
        
        .admin-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .action-box {
            background-color: var(--light-color);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .action-box:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
        }
        
        .action-box i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .results-table-container {
            overflow-x: auto;
            margin-top: 30px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: bold;
        }
        
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:hover {
            background-color: #f5f9ff;
        }
        
        .results-table .rank-1 {
            background-color: #fff9e6;
            font-weight: bold;
        }
        
        .results-table .rank-2 {
            background-color: #f0f9ff;
        }
        
        .results-table .rank-3 {
            background-color: #f0fff5;
        }
        
        .rank-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .rank-1-badge {
            background-color: gold;
            color: #333;
        }
        
        .rank-2-badge {
            background-color: silver;
            color: #333;
        }
        
        .rank-3-badge {
            background-color: #cd7f32;
            color: white;
        }
        
        .winner-announcement {
            background: linear-gradient(135deg, #fff9e6, #fff0cc);
            border: 3px solid gold;
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            margin-top: 30px;
        }
        
        .winner-announcement h3 {
            color: #e5a50a;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .winner-info {
            display: inline-flex;
            align-items: center;
            gap: 20px;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .winner-trophy {
            font-size: 3rem;
            color: gold;
        }
        
        /* چاپ کارنامه */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #result-screen, #result-screen * {
                visibility: visible;
            }
            
            #result-screen {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .no-print {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 2px solid #ddd;
            }
            
            .result-actions {
                display: none !important;
            }
        }
        
        /* واکنش‌گرایی */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            header {
                padding: 20px 15px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .admin-access {
                position: static;
                margin-top: 15px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 15px;
            }
            
            .quiz-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .start-info {
                grid-template-columns: 1fr;
            }
            
            .admin-actions {
                grid-template-columns: 1fr;
            }
            
            .winner-info {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .card-title {
                font-size: 1.2rem;
            }
            
            .score-circle {
                width: 120px;
                height: 120px;
            }
            
            .score-inner {
                width: 90px;
                height: 90px;
            }
            
            .score-value {
                font-size: 2rem;
            }
            
            .option-label {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        .login-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .hidden {
            display: none !important;
        }
        
        .flash-message {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            animation: fadeIn 0.5s;
        }
        
        .flash-success {
            background-color: #e7f7ef;
            color: var(--secondary-color);
            border: 1px solid #b8e6cf;
        }
        
        .flash-warning {
            background-color: #fff4e6;
            color: #e5a50a;
            border: 1px solid #ffdd99;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gavel"></i> سیستم آزمون انتخاب قاضی کلاس</h1>
            <p>سامانه الکترونیکی سنجش عدالت‌طلبی و مسئولیت‌پذیری دانش‌آموزان پایه پنجم</p>
            <div class="admin-access">
                <button id="admin-btn" class="btn btn-warning">
                    <i class="fas fa-lock"></i> ورود مدیریت
                </button>
            </div>
        </header>
        
        <div class="app-container">
            <!-- صفحه ثبت نام -->
            <div id="register-screen" class="card">
                <h2 class="card-title"><i class="fas fa-user-plus"></i> ثبت نام دانش‌آموز</h2>
                
                <div id="register-flash" class="flash-message hidden"></div>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="student-name"><i class="fas fa-user"></i> نام و نام خانوادگی</label>
                        <input type="text" id="student-name" class="form-control" placeholder="مثال: علی محمدی" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="student-phone"><i class="fas fa-phone"></i> شماره همراه (والدین)</label>
                        <input type="tel" id="student-phone" class="form-control" placeholder="مثال: 09123456789" pattern="09[0-9]{9}" required>
                        <small style="color: #666; display: block; margin-top: 5px;">شماره همراه باید با 09 شروع شده و 11 رقم باشد</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="student-class"><i class="fas fa-school"></i> کلاس</label>
                        <select id="student-class" class="form-control" required>
                            <option value="">انتخاب کنید</option>
                            <option value="پنجم الف">پنجم الف</option>
                            <option value="پنجم ب">پنجم ب</option>
                            <option value="پنجم ج">پنجم ج</option>
                            <option value="پنجم د">پنجم د</option>
                        </select>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check-circle"></i> ثبت نام و شروع آزمون
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- صفحه شروع آزمون -->
            <div id="start-screen" class="card hidden">
                <div class="student-info-card">
                    <h3><i class="fas fa-id-card"></i> اطلاعات دانش‌آموز</h3>
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-label">نام و نام خانوادگی:</span>
                            <span id="display-name">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">شماره همراه:</span>
                            <span id="display-phone">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">کلاس:</span>
                            <span id="display-class">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">کد شرکت در آزمون:</span>
                            <span id="display-code" style="font-family: monospace; color: var(--primary-color); font-weight: bold;">-</span>
                        </div>
                    </div>
                </div>
                
                <h2 class="card-title"><i class="fas fa-info-circle"></i> راهنمای آزمون</h2>
                
                <div class="start-info">
                    <div class="info-box">
                        <h3><i class="fas fa-clipboard-check"></i> ساختار آزمون</h3>
                        <p>این آزمون شامل ۱۵ سوال چهارگزینه‌ای است که مفاهیم عدالت، انصاف و مسئولیت‌پذیری را می‌سنجد.</p>
                    </div>
                    
                    <div class="info-box">
                        <h3><i class="fas fa-clock"></i> زمان آزمون</h3>
                        <p>آزمون محدودیت زمانی ندارد اما پیشنهاد می‌شود در مدت ۳۰ دقیقه به سوالات پاسخ دهید.</p>
                    </div>
                    
                    <div class="info-box">
                        <h3><i class="fas fa-star"></i> معیار قبولی</h3>
                        <p>حداقل نمره قبولی ۱۴ از ۲۰ است. نفرات برتر به عنوان کاندیدای قاضی کلاس معرفی می‌شوند.</p>
                    </div>
                    
                    <div class="info-box">
                        <h3><i class="fas fa-award"></i> گواهی شرکت</h3>
                        <p>پس از اتمام آزمون، کارنامه الکترونیکی با نام شما صادر خواهد شد.</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button id="start-btn" class="btn btn-success">
                        <i class="fas fa-play-circle"></i> شروع آزمون
                    </button>
                    
                    <button id="logout-btn" class="btn btn-warning">
                        <i class="fas fa-sign-out-alt"></i> خروج و ثبت نام جدید
                    </button>
                </div>
            </div>
            
            <!-- صفحه آزمون -->
            <div id="quiz-screen" class="card hidden">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div id="progress-bar" class="progress-bar"></div>
                    </div>
                    <div id="question-counter" class="question-counter">سوال ۱ از ۱۵</div>
                </div>
                
                <h2 id="question-text" class="question-text">سوال در اینجا نمایش داده می‌شود</h2>
                
                <div id="options-container" class="options-container">
                    <!-- گزینه‌ها به صورت دینامیک اضافه می‌شوند -->
                </div>
                
                <div class="quiz-navigation">
                    <button id="prev-btn" class="btn btn-accent">
                        <i class="fas fa-arrow-right"></i> سوال قبلی
                    </button>
                    
                    <button id="next-btn" class="btn">
                        سوال بعدی <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
            
            <!-- صفحه نتایج -->
            <div id="result-screen" class="card hidden">
                <div class="result-header">
                    <div class="score-circle">
                        <div class="score-inner">
                            <span id="score-value" class="score-value">۰</span>
                            <span class="score-total">از ۲۰</span>
                        </div>
                    </div>
                    
                    <h2 id="result-message" class="result-message">نتیجه آزمون شما</h2>
                    <p id="result-description">توضیحات مربوط به نتیجه نمایش داده می‌شود</p>
                    <div style="margin-top: 15px;">
                        <h3 style="color: var(--primary-color);">کارنامه: <span id="certificate-name">-</span></h3>
                        <p style="color: #666;">کد شرکت در آزمون: <strong id="certificate-code">-</strong></p>
                    </div>
                </div>
                
                <div class="result-details">
                    <h3><i class="fas fa-chart-bar"></i> آمار آزمون</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span>نام دانش‌آموز:</span>
                            <span id="result-name">-</span>
                        </div>
                        <div class="detail-item">
                            <span>کلاس:</span>
                            <span id="result-class">-</span>
                        </div>
                        <div class="detail-item">
                            <span>تاریخ آزمون:</span>
                            <span id="result-date">-</span>
                        </div>
                        <div class="detail-item">
                            <span>پاسخ‌های صحیح:</span>
                            <span id="correct-answers">۰</span>
                        </div>
                        <div class="detail-item">
                            <span>پاسخ‌های نادرست:</span>
                            <span id="incorrect-answers">۰</span>
                        </div>
                        <div class="detail-item">
                            <span>درصد موفقیت:</span>
                            <span id="success-rate">۰٪</span>
                        </div>
                        <div class="detail-item">
                            <span>وضعیت:</span>
                            <span id="status-text">در حال محاسبه</span>
                        </div>
                        <div class="detail-item">
                            <span>رتبه در کل:</span>
                            <span id="rank">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="answers-review">
                    <h3 class="card-title"><i class="fas fa-list-check"></i> بررسی پاسخ‌ها</h3>
                    <div id="review-container">
                        <!-- بررسی سوالات به صورت دینامیک اضافه می‌شود -->
                    </div>
                </div>
                
                <div class="result-actions">
                    <button id="print-btn" class="btn">
                        <i class="fas fa-print"></i> چاپ کارنامه
                    </button>
                    <button id="new-test-btn" class="btn btn-accent">
                        <i class="fas fa-user-graduate"></i> آزمون جدید (دانش‌آموز دیگر)
                    </button>
                </div>
            </div>
            
            <!-- صفحه مدیریت -->
            <div id="admin-screen" class="card hidden">
                <h2 class="card-title"><i class="fas fa-cogs"></i> پنل مدیریت سیستم</h2>
                
                <div id="admin-flash" class="flash-message hidden"></div>
                
                <div class="admin-actions">
                    <div class="action-box" id="view-results-btn">
                        <i class="fas fa-chart-bar"></i>
                        <h3>مشاهده نتایج</h3>
                        <p>نمایش نتایج تمام دانش‌آموزان شرکت‌کننده</p>
                    </div>
                    
                    <div class="action-box" id="view-winner-btn">
                        <i class="fas fa-trophy"></i>
                        <h3>برنده نهایی</h3>
                        <p>مشاهده نفر برتر آزمون</p>
                    </div>
                    
                    <div class="action-box" id="export-data-btn">
                        <i class="fas fa-download"></i>
                        <h3>خروجی داده‌ها</h3>
                        <p>دریافت فایل اکسل از نتایج</p>
                    </div>
                    
                    <div class="action-box" id="clear-data-btn">
                        <i class="fas fa-trash-alt"></i>
                        <h3>پاک کردن داده‌ها</h3>
                        <p>حذف تمام نتایج ذخیره شده</p>
                    </div>
                </div>
                
                <div id="admin-content">
                    <!-- محتوای مدیریت به صورت دینامیک نمایش داده می‌شود -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button id="admin-logout-btn" class="btn btn-warning">
                        <i class="fas fa-sign-out-alt"></i> خروج از پنل مدیریت
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>طراحی شده برای انتخاب قاضی کلاس پایه پنجم - قابل اجرا به صورت آفلاین</p>
            <p>کلیه حقوق محفوظ است - ۱۴۰۳</p>
        </div>
    </div>

    <!-- مودال ورود مدیریت -->
    <div id="login-modal" class="card hidden" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; max-width: 500px; width: 90%;">
        <h2 class="card-title"><i class="fas fa-lock"></i> ورود به بخش مدیریت</h2>
        <p style="margin-bottom: 20px;">برای دسترسی به پنل مدیریت، رمز عبور را وارد کنید.</p>
        
        <div class="form-group">
            <label for="admin-password">رمز عبور مدیریت</label>
            <input type="password" id="admin-password" class="form-control" placeholder="رمز عبور را وارد کنید">
        </div>
        
        <div style="text-align: center; margin-top: 25px;">
            <button id="login-submit-btn" class="btn btn-success">
                <i class="fas fa-sign-in-alt"></i> ورود به پنل
            </button>
            <button id="login-cancel-btn" class="btn">
                <i class="fas fa-times"></i> انصراف
            </button>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666; text-align: center;">
            <p>رمز عبور پیش‌فرض: <code>admin123</code></p>
            <p>برای تغییر رمز، کد زیر را در کنسول مرورگر اجرا کنید:</p>
            <p><code style="background: #f5f5f5; padding: 5px; border-radius: 4px;">localStorage.setItem('judge_system_admin_pass', 'رمز جدید')</code></p>
        </div>
    </div>

    <div id="modal-overlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999;"></div>

    <script>
        // داده‌های آزمون
        const quizData = [
            {
                question: "دوستت به دلیل شلوغی در زنگ تفریح، به اشتباه از ناظم اخطار می‌گیرد، اما تو می‌دانی مقصر واقعی شخص دیگری بوده. بهترین کار چیست؟",
                options: [
                    "سکوت می‌کنم، زیرا ممکن است برایم مشکل ایجاد شود.",
                    "فقط با دوستم هم‌دردی می‌کنم.",
                    "نزد ناظم می‌روم و با ادب حق مطلب را می‌گویم.",
                    "مقصر واقعی را در جمع شرمنده می‌کنم."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. یک قاضی منصف باید برای کشف حقیقت و اجرای عدالت تلاش کند، حتی اگر این کار برایش مشکل‌ساز باشد."
            },
            {
                question: "بین دو تا از دوستانت بر سر یک مداد رنگی اختلاف پیش آمده. هر کدام ادعا می‌کنند مال خودشان است. به عنوان قاضی چه می‌کنی؟",
                options: [
                    "از هر دو می‌خواهم قسم بخورند.",
                    "از شاهدهای احتمالی می‌پرسم.",
                    "قرعه می‌اندازم تا تصمیم بگیرد.",
                    "مداد را از هر دو می‌گیرم تا دعوا تمام شود."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. یک قاضی خوب باید شواهد و مدارک را بررسی کند و به دنبال شاهدان باشد، نه اینکه بر اساس احساس یا شانس تصمیم بگیرد."
            },
            {
                question: "کدام مورد، نمونه‌ای از 'رعایت نوبت' است؟",
                options: [
                    "زودتر تمام کردن غذا برای رفتن به حیاط.",
                    "در صف نماز به کسی که جلوی ما ایستاده است نگوییم 'عجله کن'.",
                    "هنگام پخش شیرینی، از همه بیشتر برداریم.",
                    "در بازی دوز، بدون نوبت مهره بگذاریم."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. رعایت نوبت به معنای احترام به حقوق دیگران و صبر کردن برای نوبت خود است، نه عجله کردن یا تحت فشار قرار دادن دیگران."
            },
            {
                question: "کدام گزینه نشان‌دهنده 'انصاف' است؟",
                options: [
                    "فقط به دوستان نزدیکم در انجام تکلیف کمک کنم.",
                    "در تیم‌بندی بازی، همیشه بهترین بازیکنان را در یک تیم قرار دهم.",
                    "اگر کسی در حق من بدی کرد، من هم در فرصت مناسب تلافی کنم.",
                    "بین خواهر و برادرم که با هم دعوا کرده‌اند، بدون جانبداری قضاوت کنم."
                ],
                correctAnswer: 3,
                explanation: "پاسخ صحیح گزینه ۴ است. انصاف به معنای بی‌طرفی و قضاوت عادلانه بدون جانبداری از افراد است، حتی اگر با آنها رابطه نزدیک داشته باشیم."
            },
            {
                question: "معلم از کلاس می‌پرسد: 'چه کسی پنجره را شکست؟' تو می‌دانی مقصر کیست، اما او دوست صمیمی شماست. چه می‌کنی؟",
                options: [
                    "چیزی نمی‌گویم.",
                    "به معلم می‌گویم، اما از او می‌خواهم اسم من را فاش نکند.",
                    "بعد از کلاس به دوستم می‌گویم خودش اعتراف کند.",
                    "می‌گویم نمی‌دانم."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. یک قاضی منصف هم باید به کشف حقیقت کمک کند و هم حقوق افراد را در نظر بگیرد. تشویق دوست به اعتراف داوطلبانه، راه حلی منصفانه است."
            },
            {
                question: "در مسابقه‌ی گروهی، یکی از اعضای گروهتان تقلب می‌کند و شما برنده می‌شوید. بهترین عکس العمل چیست؟",
                options: [
                    "خوشحال می‌شوم چون برنده شده‌ایم.",
                    "در دل به آن عضو تیم اعتراض می‌کنم ولی چیزی نمی‌گویم.",
                    "به او تذکر می‌دهم و گروه را متقاعد می‌کنم که تقلب نکنیم.",
                    "به داور مسابقه گزارش می‌دهم."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. یک قاضی خوب باید با تقلب مخالفت کند و دیگران را به رعایت قوانین تشویق کند، اما بهتر است ابتدا از روش‌های دوستانه و درون‌گروهی استفاده کند."
            },
            {
                question: "قاضی کلاس باید بیشتر چه ویژگی‌ای داشته باشد؟",
                options: [
                    "محبوب‌ترین فرد کلاس باشد.",
                    "قوی‌ترین و باهوش‌ترین باشد.",
                    "عادل، صبور و خوب گوش دهد.",
                    "خیلی جدی و سخت‌گیر باشد."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. مهمترین ویژگی‌های یک قاضی، عدالت، صبر و گوش دادن فعال به همه طرف‌های دعوا است، نه محبوبیت یا قدرت جسمی."
            },
            {
                question: "کدام رفتار، 'قضاوت عجولانه' محسوب می‌شود؟",
                options: [
                    "قبل از تصمیم‌گیری، حرف هر دو طرف را بشنوم.",
                    "فقط به حرف یک نفر که صدایش بلندتر است اعتماد کنم.",
                    "از هر دو طرف بخواهم راه حلی پیشنهاد دهند.",
                    "به دنبال شاهد بگردم."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. قضاوت عجولانه به معنای تصمیم‌گیری سریع بدون بررسی همه شواهد و شنیدن صحبت همه طرف‌های درگیر است."
            },
            {
                question: "اگر بخواهیم کلاس ما قانون جدیدی داشته باشد، بهترین روش چیست؟",
                options: [
                    "فقط معلم قانون را وضع کند.",
                    "چند نفر از شاگردهای زرنگ کلاس تصمیم بگیرند.",
                    "با رای‌گیری و نظرخواهی از همه، بهترین قانون انتخاب شود.",
                    "قاضی کلاس به تنهایی تصمیم بگیرد."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. دموکراسی و مشارکت همه افراد در تصمیم‌گیری‌های جمعی، باعث می‌شود قوانین بهتر رعایت شوند و همه خود را در قبال آنها مسئول بدانند."
            },
            {
                question: "اگر خودت مرتکب اشتباهی شوی، رفتار منصفانه چیست؟",
                options: [
                    "سعی کنم اشتباهم را مخفی کنم.",
                    "دیگران را مقصر جلوه دهم.",
                    "مسئولیت کارم را بپذیرم و عذرخواهی کنم.",
                    "منتظر بمانم کسی متوجه شود."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. یک قاضی منصف باید بتواند مسئولیت اشتباهات خود را بپذیرد و از دیگران نیز همین انتظار را داشته باشد."
            },
            {
                question: "کدام جمله، یک 'قانون خوب' برای کلاس است؟",
                options: [
                    "هر کس دیر کند، یک هفته از زنگ تفریح محروم است.",
                    "هنگام صحبت معلم یا همکلاسی، با احترام گوش دهیم.",
                    "کسی حق ندارد با کسی دیگر بازی کند.",
                    "انجام تکالیف اختیاری است."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. یک قانون خوب باید واضح، معقول، قابل اجرا و منصفانه باشد و به ایجاد نظم و احترام متقابل کمک کند."
            },
            {
                question: "نقش اصلی 'قاضی کلاس' چیست؟",
                options: [
                    "تنبیه کردن دانش‌آموزان خطاکار.",
                    "کمک به حل مسالمت‌آمیز اختلافات و نظارت بر رعایت قوانین.",
                    "نمره دادن به بقیه.",
                    "گزارش تمام رفتارهای بد به معلم."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. قاضی کلاس یک میانجی و تسهیل‌گر است که به حل اختلافات کمک می‌کند و بر اجرای قوانین نظارت دارد، نه یک مجری تنبیه."
            },
            {
                question: "اگر دو نفر هر دو برای یک نقش در مراسم مدرسه داوطلب باشند، بهترین روش انتخاب چیست؟",
                options: [
                    "آنکه صدای بلندتری دارد، انتخاب شود.",
                    "قرعه‌کشی کنیم.",
                    "از هر دو آزمون بگیریم و بهترین اجرا را انتخاب کنیم.",
                    "معلم به اجبار یکی را انتخاب کند."
                ],
                correctAnswer: 2,
                explanation: "پاسخ صحیح گزینه ۳ است. در شرایط مساوی، منصفانه‌ترین روش، ارزیابی عادلانه توانایی‌ها و انتخاب فرد شایسته‌تر است."
            },
            {
                question: "'میانجی‌گری' یعنی چه؟",
                options: [
                    "تصمیم گرفتن به جای دیگران.",
                    "کمک به دو طرف دعوا برای صحبت کردن و پیدا کردن راه حل.",
                    "تعیین کردن مقصر اصلی.",
                    "پایان دادن به دوستی بین افرادی که دعوا کرده‌اند."
                ],
                correctAnswer: 1,
                explanation: "پاسخ صحیح گزینه ۲ است. میانجی‌گری به معنای کمک به طرفین برای گفت‌وگو و یافتن راه حل مورد توافق است، نه تصمیم‌گیری یکطرفه."
            },
            {
                question: "وقتی کسی بعد از اشتباهش عذرخواهی صادقانه می‌کند، رفتار منصفانه چیست؟",
                options: [
                    "او را ببخشیم و رابطه‌مان را ادامه دهیم.",
                    "هرگز او را نبخشیم.",
                    "فقط با او حرف بزنیم اما دیگر دوستش نباشیم.",
                    "تلافی کنیم."
                ],
                correctAnswer: 0,
                explanation: "پاسخ صحیح گزینه ۱ است. بخشش پس از عذرخواهی صادقانه، نشانه بلوغ و عدالت است و به ترمیم روابط کمک می‌کند."
            }
        ];

        // متغیرهای حالت برنامه
        let currentQuestion = 0;
        let userAnswers = Array(quizData.length).fill(null);
        let currentStudent = null;
        let allResults = JSON.parse(localStorage.getItem('judge_system_results')) || [];
        
        // تنظیم رمز عبور مدیریت
        if (!localStorage.getItem('judge_system_admin_pass')) {
            localStorage.setItem('judge_system_admin_pass', 'admin123');
        }

        // عناصر DOM
        const registerScreen = document.getElementById('register-screen');
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const adminScreen = document.getElementById('admin-screen');
        const loginModal = document.getElementById('login-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        
        const registerForm = document.getElementById('register-form');
        const adminBtn = document.getElementById('admin-btn');
        const startBtn = document.getElementById('start-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const newTestBtn = document.getElementById('new-test-btn');
        const printBtn = document.getElementById('print-btn');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        const loginSubmitBtn = document.getElementById('login-submit-btn');
        const loginCancelBtn = document.getElementById('login-cancel-btn');
        
        const viewResultsBtn = document.getElementById('view-results-btn');
        const viewWinnerBtn = document.getElementById('view-winner-btn');
        const exportDataBtn = document.getElementById('export-data-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');
        const questionCounter = document.getElementById('question-counter');
        
        // اطلاعات دانش‌آموز
        const displayName = document.getElementById('display-name');
        const displayPhone = document.getElementById('display-phone');
        const displayClass = document.getElementById('display-class');
        const displayCode = document.getElementById('display-code');
        
        // نتایج
        const scoreValue = document.getElementById('score-value');
        const correctAnswersEl = document.getElementById('correct-answers');
        const incorrectAnswersEl = document.getElementById('incorrect-answers');
        const successRate = document.getElementById('success-rate');
        const statusText = document.getElementById('status-text');
        const resultMessage = document.getElementById('result-message');
        const resultDescription = document.getElementById('result-description');
        const reviewContainer = document.getElementById('review-container');
        const resultName = document.getElementById('result-name');
        const resultClass = document.getElementById('result-class');
        const resultDate = document.getElementById('result-date');
        const certificateName = document.getElementById('certificate-name');
        const certificateCode = document.getElementById('certificate-code');
        const rank = document.getElementById('rank');
        
        // فلش پیام‌ها
        const registerFlash = document.getElementById('register-flash');
        const adminFlash = document.getElementById('admin-flash');
        
        // محتوای مدیریت
        const adminContent = document.getElementById('admin-content');

        // رویدادها
        registerForm.addEventListener('submit', registerStudent);
        adminBtn.addEventListener('click', showLoginModal);
        startBtn.addEventListener('click', startQuiz);
        prevBtn.addEventListener('click', showPrevQuestion);
        nextBtn.addEventListener('click', showNextQuestion);
        logoutBtn.addEventListener('click', logoutStudent);
        newTestBtn.addEventListener('click', newTest);
        printBtn.addEventListener('click', printCertificate);
        adminLogoutBtn.addEventListener('click', logoutAdmin);
        loginSubmitBtn.addEventListener('click', loginAdmin);
        loginCancelBtn.addEventListener('click', hideLoginModal);
        
        viewResultsBtn.addEventListener('click', showAllResults);
        viewWinnerBtn.addEventListener('click', showWinner);
        exportDataBtn.addEventListener('click', exportData);
        clearDataBtn.addEventListener('click', clearData);

        // ثبت نام دانش‌آموز
        function registerStudent(e) {
            e.preventDefault();
            
            const name = document.getElementById('student-name').value.trim();
            const phone = document.getElementById('student-phone').value.trim();
            const studentClass = document.getElementById('student-class').value;
            
            if (!name || !phone || !studentClass) {
                showFlash(registerFlash, 'لطفاً تمام فیلدها را پر کنید.', 'warning');
                return;
            }
            
            // بررسی فرمت شماره همراه
            const phoneRegex = /^09[0-9]{9}$/;
            if (!phoneRegex.test(phone)) {
                showFlash(registerFlash, 'شماره همراه باید با 09 شروع شده و 11 رقم باشد.', 'warning');
                return;
            }
            
            // ایجاد کد منحصر به فرد
            const studentCode = generateStudentCode();
            
            // ذخیره اطلاعات دانش‌آموز
            currentStudent = {
                id: Date.now(),
                name,
                phone,
                class: studentClass,
                code: studentCode,
                date: new Date().toLocaleDateString('fa-IR'),
                timestamp: Date.now()
            };
            
            // نمایش اطلاعات
            displayName.textContent = name;
            displayPhone.textContent = phone;
            displayClass.textContent = studentClass;
            displayCode.textContent = studentCode;
            
            // تغییر صفحه
            registerScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            
            showFlash(registerFlash, 'ثبت نام با موفقیت انجام شد. اکنون می‌توانید آزمون را شروع کنید.', 'success');
        }

        // شروع آزمون
        function startQuiz() {
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            currentQuestion = 0;
            userAnswers = Array(quizData.length).fill(null);
            loadQuestion();
        }

        // بارگذاری سوال
        function loadQuestion() {
            const question = quizData[currentQuestion];
            questionText.textContent = `${currentQuestion + 1}. ${question.question}`;
            
            // به روزرسانی پیشرفت
            const progressPercent = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progressPercent}%`;
            questionCounter.textContent = `سوال ${currentQuestion + 1} از ${quizData.length}`;
            
            // بارگذاری گزینه‌ها
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                if (userAnswers[currentQuestion] === index) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-label">${String.fromCharCode(1575 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            // به روزرسانی دکمه‌های ناوبری
            prevBtn.style.display = currentQuestion === 0 ? 'none' : 'inline-flex';
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'پایان آزمون' : 'سوال بعدی';
            nextBtn.innerHTML = currentQuestion === quizData.length - 1 ? 
                'پایان آزمون <i class="fas fa-flag-checkered"></i>' : 
                'سوال بعدی <i class="fas fa-arrow-left"></i>';
        }

        // انتخاب گزینه
        function selectOption(optionIndex) {
            userAnswers[currentQuestion] = optionIndex;
            
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // سوال قبلی
        function showPrevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        // سوال بعدی
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        // پایان آزمون
        function finishQuiz() {
            // محاسبه نتایج
            let correctCount = 0;
            
            quizData.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    correctCount++;
                }
            });
            
            // محاسبه نمره (هر سوال 1 نمره)
            const score = correctCount;
            const percentage = Math.round((correctCount / quizData.length) * 100);
            const passed = score >= 14;
            
            // ذخیره نتیجه
            const result = {
                ...currentStudent,
                score,
                correctCount,
                totalQuestions: quizData.length,
                percentage,
                passed,
                answers: [...userAnswers],
                completed: true,
                completionDate: new Date().toLocaleString('fa-IR')
            };
            
            // افزودن به لیست نتایج
            allResults.push(result);
            localStorage.setItem('judge_system_results', JSON.stringify(allResults));
            
            // نمایش نتایج
            showResults(result);
        }

        // نمایش نتایج
        function showResults(result) {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            // محاسبه رتبه
            const sortedResults = [...allResults]
                .filter(r => r.completed)
                .sort((a, b) => b.score - a.score);
            
            const studentRank = sortedResults.findIndex(r => r.id === result.id) + 1;
            const totalParticipants = sortedResults.length;
            
            // نمایش اطلاعات
            scoreValue.textContent = result.score;
            correctAnswersEl.textContent = result.correctCount;
            incorrectAnswersEl.textContent = result.totalQuestions - result.correctCount;
            successRate.textContent = `${result.percentage}%`;
            resultName.textContent = result.name;
            resultClass.textContent = result.class;
            resultDate.textContent = result.completionDate;
            certificateName.textContent = result.name;
            certificateCode.textContent = result.code;
            rank.textContent = `${studentRank} از ${totalParticipants}`;
            
            // وضعیت
            statusText.textContent = result.passed ? "قبول شده" : "قبول نشده";
            statusText.style.color = result.passed ? "var(--secondary-color)" : "var(--danger-color)";
            
            // پیام نتیجه
            if (result.score >= 18) {
                resultMessage.textContent = "عالی! شما شایستگی لازم برای قاضی کلاس را دارید!";
                resultDescription.textContent = `نمره شما ${result.score} از ۲۰ است. شما در رتبه ${studentRank} از ${totalParticipants} شرکت‌کننده قرار دارید.`;
            } else if (result.score >= 14) {
                resultMessage.textContent = "آفرین! شما قبول شدید!";
                resultDescription.textContent = `نمره شما ${result.score} از ۲۰ است. شما در رتبه ${studentRank} از ${totalParticipants} شرکت‌کننده قرار دارید.`;
            } else {
                resultMessage.textContent = "نیاز به تلاش بیشتر دارید";
                resultDescription.textContent = `نمره شما ${result.score} از ۲۰ است و کمتر از حد نصاب ۱۴ می‌باشد.`;
            }
            
            // نمایش بررسی پاسخ‌ها
            displayAnswersReview();
            
            // به روزرسانی نمودار پیشرفت
            const scoreCircle = document.querySelector('.score-circle');
            const scorePercent = (result.score / 20) * 100;
            scoreCircle.style.background = `conic-gradient(var(--secondary-color) 0% ${scorePercent}%, #eee ${scorePercent}% 100%)`;
        }

        // نمایش بررسی پاسخ‌ها
        function displayAnswersReview() {
            reviewContainer.innerHTML = '';
            
            quizData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;
                
                const reviewItem = document.createElement('div');
                reviewItem.classList.add('review-item');
                reviewItem.classList.add(isCorrect ? 'correct' : 'incorrect');
                
                reviewItem.innerHTML = `
                    <div class="review-question">سوال ${index + 1}: ${question.question}</div>
                    <div class="review-answer user-answer">
                        <strong>پاسخ شما:</strong> 
                        ${userAnswer !== null ? question.options[userAnswer] : 'پاسخی داده نشده'}
                        ${isCorrect ? ' <i class="fas fa-check" style="color: var(--secondary-color);"></i>' : ' <i class="fas fa-times" style="color: var(--danger-color);"></i>'}
                    </div>
                    ${!isCorrect ? `
                    <div class="review-answer correct-answer">
                        <strong>پاسخ صحیح:</strong> ${question.options[question.correctAnswer]}
                    </div>
                    ` : ''}
                    <div style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 8px;">
                        <strong>توضیح:</strong> ${question.explanation}
                    </div>
                `;
                
                reviewContainer.appendChild(reviewItem);
            });
        }

        // خروج دانش‌آموز
        function logoutStudent() {
            currentStudent = null;
            userAnswers = Array(quizData.length).fill(null);
            currentQuestion = 0;
            
            startScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
            
            // ریست فرم
            registerForm.reset();
        }

        // آزمون جدید برای دانش‌آموز دیگر
        function newTest() {
            currentStudent = null;
            userAnswers = Array(quizData.length).fill(null);
            currentQuestion = 0;
            
            resultScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
            
            // ریست فرم
            registerForm.reset();
        }

        // چاپ کارنامه
        function printCertificate() {
            window.print();
        }

        // نمایش مودال ورود مدیریت
        function showLoginModal() {
            loginModal.classList.remove('hidden');
            modalOverlay.classList.remove('hidden');
        }

        // پنهان کردن مودال ورود
        function hideLoginModal() {
            loginModal.classList.add('hidden');
            modalOverlay.classList.add('hidden');
        }

        // ورود مدیریت
        function loginAdmin() {
            const password = document.getElementById('admin-password').value;
            const storedPassword = localStorage.getItem('judge_system_admin_pass');
            
            if (password === storedPassword) {
                // پنهان کردن همه صفحات
                registerScreen.classList.add('hidden');
                startScreen.classList.add('hidden');
                quizScreen.classList.add('hidden');
                resultScreen.classList.add('hidden');
                
                // نمایش صفحه مدیریت
                adminScreen.classList.remove('hidden');
                hideLoginModal();
                
                // نمایش نتایج به صورت پیش‌فرض
                showAllResults();
            } else {
                alert('رمز عبور اشتباه است!');
            }
        }

        // خروج مدیریت
        function logoutAdmin() {
            adminScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
            currentStudent = null;
        }

        // نمایش همه نتایج
        function showAllResults() {
            // بارگذاری مجدد نتایج
            allResults = JSON.parse(localStorage.getItem('judge_system_results')) || [];
            
            // فیلتر نتایج کامل
            const completedResults = allResults.filter(r => r.completed);
            
            // مرتب‌سازی بر اساس نمره
            const sortedResults = [...completedResults].sort((a, b) => b.score - a.score);
            
            let html = `
                <h3 class="card-title"><i class="fas fa-list-ol"></i> نتایج تمام دانش‌آموزان</h3>
                <p>تعداد شرکت‌کنندگان: <strong>${sortedResults.length}</strong> نفر</p>
            `;
            
            if (sortedResults.length === 0) {
                html += '<div class="flash-message flash-warning" style="margin-top: 20px;">هنوز هیچ نتیجه‌ای ثبت نشده است.</div>';
            } else {
                html += `
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>رتبه</th>
                                    <th>نام دانش‌آموز</th>
                                    <th>کلاس</th>
                                    <th>کد آزمون</th>
                                    <th>نمره</th>
                                    <th>صحیح</th>
                                    <th>غلط</th>
                                    <th>درصد</th>
                                    <th>وضعیت</th>
                                    <th>تاریخ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                sortedResults.forEach((result, index) => {
                    const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                    const rankBadge = index === 0 ? '<span class="rank-badge rank-1-badge">اول</span>' : 
                                      index === 1 ? '<span class="rank-badge rank-2-badge">دوم</span>' : 
                                      index === 2 ? '<span class="rank-badge rank-3-badge">سوم</span>' : 
                                      `<span>${index + 1}</span>`;
                    
                    const incorrectCount = result.totalQuestions - result.correctCount;
                    const status = result.passed ? '<span style="color: var(--secondary-color);">قبول</span>' : '<span style="color: var(--danger-color);">مردود</span>';
                    
                    html += `
                        <tr class="${rankClass}">
                            <td>${rankBadge}</td>
                            <td><strong>${result.name}</strong></td>
                            <td>${result.class}</td>
                            <td><code>${result.code}</code></td>
                            <td><strong>${result.score}/20</strong></td>
                            <td>${result.correctCount}</td>
                            <td>${incorrectCount}</td>
                            <td>${result.percentage}%</td>
                            <td>${status}</td>
                            <td>${result.completionDate || result.date}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            adminContent.innerHTML = html;
        }

        // نمایش برنده نهایی
        function showWinner() {
            allResults = JSON.parse(localStorage.getItem('judge_system_results')) || [];
            const completedResults = allResults.filter(r => r.completed);
            
            if (completedResults.length === 0) {
                adminContent.innerHTML = `
                    <div class="flash-message flash-warning">
                        هنوز هیچ نتیجه‌ای ثبت نشده است.
                    </div>
                `;
                return;
            }
            
            // مرتب‌سازی بر اساس نمره
            const sortedResults = [...completedResults].sort((a, b) => {
                // اول بر اساس نمره، سپس بر اساس تاریخ (زودتر انجام داده باشد اولویت دارد)
                if (b.score !== a.score) return b.score - a.score;
                return a.timestamp - b.timestamp;
            });
            
            const winner = sortedResults[0];
            const runnersUp = sortedResults.slice(1, 3); // نفرات دوم و سوم
            
            let html = `
                <h3 class="card-title"><i class="fas fa-trophy"></i> برنده نهایی آزمون قاضی کلاس</h3>
                
                <div class="winner-announcement">
                    <h3>🏆 قاضی منتخب کلاس 🏆</h3>
                    <div class="winner-info">
                        <div class="winner-trophy">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div>
                            <h2 style="color: var(--primary-color); margin-bottom: 5px;">${winner.name}</h2>
                            <p style="margin-bottom: 5px;">کلاس: ${winner.class}</p>
                            <p style="margin-bottom: 5px;">نمره: <strong>${winner.score} از 20</strong></p>
                            <p style="margin-bottom: 5px;">درصد موفقیت: <strong>${winner.percentage}%</strong></p>
                            <p>کد آزمون: <code>${winner.code}</code></p>
                        </div>
                    </div>
                </div>
            `;
            
            if (runnersUp.length > 0) {
                html += `
                    <h3 style="margin-top: 30px; color: var(--primary-color);">نفرات برتر بعدی</h3>
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>رتبه</th>
                                    <th>نام دانش‌آموز</th>
                                    <th>کلاس</th>
                                    <th>نمره</th>
                                    <th>درصد</th>
                                    <th>وضعیت</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                runnersUp.forEach((runner, index) => {
                    const rank = index + 2;
                    const rankBadge = rank === 2 ? '<span class="rank-badge rank-2-badge">دوم</span>' : 
                                      rank === 3 ? '<span class="rank-badge rank-3-badge">سوم</span>' : 
                                      `<span>${rank}</span>`;
                    
                    const status = runner.passed ? '<span style="color: var(--secondary-color);">قبول</span>' : '<span style="color: var(--danger-color);">مردود</span>';
                    
                    html += `
                        <tr class="${rank === 2 ? 'rank-2' : 'rank-3'}">
                            <td>${rankBadge}</td>
                            <td><strong>${runner.name}</strong></td>
                            <td>${runner.class}</td>
                            <td><strong>${runner.score}/20</strong></td>
                            <td>${runner.percentage}%</td>
                            <td>${status}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            html += `
                <div style="margin-top: 30px; padding: 20px; background-color: var(--light-color); border-radius: var(--border-radius);">
                    <h4><i class="fas fa-info-circle"></i> نحوه انتخاب برنده:</h4>
                    <ul style="padding-right: 20px; margin-top: 10px;">
                        <li>اولویت اول: بالاترین نمره (از 20)</li>
                        <li>در صورت تساوی نمره: فردی که آزمون را زودتر تکمیل کرده باشد</li>
                        <li>حداقل نمره برای احراز مقام قاضی کلاس: 14 از 20</li>
                    </ul>
                </div>
            `;
            
            adminContent.innerHTML = html;
        }

        // خروجی داده‌ها
        function exportData() {
            allResults = JSON.parse(localStorage.getItem('judge_system_results')) || [];
            const completedResults = allResults.filter(r => r.completed);
            
            if (completedResults.length === 0) {
                showFlash(adminFlash, 'هیچ داده‌ای برای خروجی وجود ندارد.', 'warning');
                return;
            }
            
            // ایجاد داده‌های CSV
            let csv = 'نام,نام خانوادگی,کلاس,شماره همراه,کد آزمون,نمره,صحیح,غلط,درصد,وضعیت,تاریخ\n';
            
            completedResults.forEach(result => {
                // جداسازی نام و نام خانوادگی
                const nameParts = result.name.split(' ');
                const firstName = nameParts[0] || '';
                const lastName = nameParts.slice(1).join(' ') || '';
                
                const incorrectCount = result.totalQuestions - result.correctCount;
                const status = result.passed ? 'قبول' : 'مردود';
                
                csv += `"${firstName}","${lastName}","${result.class}","${result.phone}","${result.code}",${result.score},${result.correctCount},${incorrectCount},${result.percentage}%,"${status}","${result.completionDate || result.date}"\n`;
            });
            
            // ایجاد فایل و دانلود
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `نتایج_آزمون_قاضی_کلاس_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.csv`;
            link.click();
            
            showFlash(adminFlash, `فایل خروجی با ${completedResults.length} رکورد ایجاد و دانلود شد.`, 'success');
        }

        // پاک کردن داده‌ها
        function clearData() {
            if (confirm('آیا مطمئن هستید که می‌خواهید تمام داده‌های نتایج را حذف کنید؟ این عمل غیرقابل بازگشت است.')) {
                localStorage.removeItem('judge_system_results');
                allResults = [];
                showAllResults();
                showFlash(adminFlash, 'تمامی داده‌های نتایج با موفقیت حذف شدند.', 'success');
            }
        }

        // نمایش پیام فلش
        function showFlash(element, message, type) {
            element.textContent = message;
            element.className = `flash-message flash-${type}`;
            element.classList.remove('hidden');
            
            // مخفی کردن خودکار پس از 5 ثانیه
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }

        // تولید کد منحصر به فرد برای دانش‌آموز
        function generateStudentCode() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            let code = '';
            
            // 3 حرف تصادفی
            for (let i = 0; i < 3; i++) {
                code += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            
            // 4 عدد تصادفی
            for (let i = 0; i < 4; i++) {
                code += numbers.charAt(Math.floor(Math.random() * numbers.length));
            }
            
            return code;
        }

        // بارگذاری اولیه
        document.addEventListener('DOMContentLoaded', () => {
            // نمایش صفحه ثبت نام
            registerScreen.classList.remove('hidden');
            startScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            adminScreen.classList.add('hidden');
            loginModal.classList.add('hidden');
            modalOverlay.classList.add('hidden');
        });
    </script>
</body>
</html>